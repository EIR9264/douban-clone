services:
  nacos:
    image: nacos/nacos-server:v2.3.2
    container_name: douban-nacos
    environment:
      - MODE=standalone
      # dev 环境建议关闭鉴权，方便快速联调
      - NACOS_AUTH_ENABLE=false
      - PREFER_HOST_MODE=hostname
      - JVM_XMS=256m
      - JVM_XMX=256m
      - JVM_XMN=128m
    ports:
      - "8848:8848" # web/ui + client
      - "9848:9848" # grpc (2.x)
      - "9849:9849" # grpc (2.x)
    volumes:
      - nacos-data:/home/nacos/data
      - nacos-logs:/home/nacos/logs
    restart: unless-stopped

  redis:
    image: redis:7.4-alpine
    container_name: douban-redis
    command: ["redis-server", "--appendonly", "yes"]
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped

  minio:
    image: minio/minio:latest
    container_name: douban-minio
    environment:
      - MINIO_ROOT_USER=${MINIO_ROOT_USER:-admin}
      - MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD:-admin123456}
    command: ["server", "/data", "--console-address", ":9001"]
    ports:
      - "9000:9000" # S3 API
      - "9001:9001" # Web Console
    volumes:
      - minio-data:/data
    restart: unless-stopped

volumes:
  nacos-data:
  nacos-logs:
  redis-data:
  minio-data:
